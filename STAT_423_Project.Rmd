---
title: "STAT 423 Project"
output: html_document
date: "2025-04-02"
---

```{r setup, include=FALSE}
install.packages("mosaic")
library("mosaic")
install.packages("ggplot2")
library(ggplot2)


install.packages("DescTools")
library(DescTools)

Skip_class <- read.csv("https://raw.githubusercontent.com/badongskii/stat423_skipping_class_survey/refs/heads/main/skippingclass_cleaned.csv")
attach(Skip_class)
Skip_class
names(Skip_class)

```
Applying modal imputation to fill non-responses
```{r}
#summary to show quick stats of each column in csv file. Reveals how many non responses in each.
summary(Skip_class)

```
Code to check which indices are n/a
```{r}
which(is.na(Skip_class$Percentage.Skip))
which(is.na(Skip_class$Types.Classes))
which(is.na(Skip_class$Options.Main))
which(is.na(Skip_class$Review.missed.material))
```
Missing data in Percentage.Skip, Types.Classes, Options.Main and Review.missed.material.
Find mean for each column which will be imputed later.
Note: decided to do mode since almost all questions are categorical.
```{r}
#mean.percentage.skip <- favstats(~Percentage.Skip, data = Skip_class)$mean
#mean.types.classes <- favstats(~Types.Classes, data = Skip_class)$mean
#mean.options.main <- favstats(~Options.Main, data = Skip_class)$mean
#mean.review.material <- favstats(~Review.missed.material, data = Skip_class)$mean

Skip_class.imputed <- Skip_class #copy of the data set

#Skip_class.imputed$Percentage.Skip[which(is.na(Skip_class$Percentage.Skip))] <- mean.percentage.skip
#Skip_class.imputed$Types.Classes[which(is.na(Skip_class$Types.Classes))] <- mean.types.classes
#Skip_class.imputed$Options.Main[which(is.na(Skip_class$Options.Main))] <- mean.options.main
#Skip_class.imputed$Review.missed.material[which(is.na(Review.missed.material))] <- mean.review.material

Mode(Skip_class$Percentage.Skip, na.rm = T)
mode.percentage.skip <- Mode(Skip_class$Percentage.Skip, na.rm = T)[[1]]
Skip_class.imputed$Percentage.Skip[which(is.na(Skip_class$Percentage.Skip))] <- mode.percentage.skip

Mode(Skip_class$Types.Classes, na.rm = T)
mode.type.classes <- Mode(Skip_class$Types.Classes, na.rm = T)[[1]]
Skip_class.imputed$Types.Classes[which(is.na(Skip_class$Types.Classes))] <- mode.type.classes

Mode(Skip_class$Options.Main, na.rm = T)
mode.options.main <- Mode(Skip_class$Options.Main, na.rm = T)[[1]]
Skip_class.imputed$Options.Main[which(is.na(Skip_class$Options.Main))] <- mode.options.main

Mode(Skip_class$Review.missed.material, na.rm = T)
mode.review.material <- Mode(Skip_class$Review.missed.material, na.rm = T)[[1]]
Skip_class.imputed$Review.missed.material[which(is.na(Review.missed.material))] <- mode.review.material

Skip_class.imputed
```


```{r}
summary(Skip_class.imputed)
```
Data is now cleaned.


#Compute a linear regression analyisis to determine our most important variables:
```{r}
skip_mod1 <- lm(`Percentage.Skip`~Gender+`Year.Study`+Courses+Reason+`Types.Classes`+`Options.Main`+`Review.missed.material`+`Grades.affected`+`Transport`+`Factor.not.to.skip`, data = Skip_class.imputed)
summary(skip_mod1)

```


## Get the mean values from the data collected:


```{r}
favstats(~Reason, data = Skip_class.imputed)
favstats(~Year.Study, data = Skip_class.imputed)
favstats(~Options.Main, data = Skip_class.imputed)
favstats(~Factor.not.to.skip, data = Skip_class.imputed)


```
$$
\begin{array}{lccc}
                           &  Mean   &  Sd    &  n       \\[0.5ex]
\hline
\text{Reason}    &   4.67     &   2.98      & 40                     \\[0.5ex]
\text{Year of Study}          &   2.5      &   1.13       &  40    &       \\[0.5ex]
\text{Options or Main Classes} &  1.27  & 0.452    & 40     \\[0.5ex]  
\text{Factor to not Skip Class}   &  2.7 & 1.02 & 40     \\[0.5ex]

\hline 
\end{array}
$$

## Including Plots


```{r}
hist(`Reason`,col="tomato2")
hist(`Year.Study`,col="gold2")
hist(`Options.Main`, col="lightskyblue")
hist(`Factor.not.to.skip`, col="lightcyan3")
```

Reason to not skip class proportion (Top 2)
```{r}
n <- 40
N <- 7400

most.combined <- sum(Skip_class.imputed$Factor.not.to.skip == 2) + 
                  sum(Skip_class.imputed$Factor.not.to.skip == 3)

prop.most.combined <- most.combined / n

#CI with 95% confidence
z <- qnorm(0.95)
most.combined.error <- sqrt((prop.most.combined*(1 - prop.most.combined)/(n - 1))*((N - n)/N))

most.combined.lb <- prop.most.combined - z * most.combined.error
most.combined.ub <- prop.most.combined + z * most.combined.error

cat("95% CI: [", most.combined.lb, ",", most.combined.ub, "]\n")
```
Conclusion: We can say with 95% confidence that between 53% and 78% of science students would choose not to skip class due to required attendance and lack of online material.




```{r}
Science_pop <- 7400
Sample_sn <- 40
Study_num <- 14
Not_useful <- 13
Other_reason <- 7
Study_p <- 14/40
NUsef_p <- 13/40
Other_p <- 7/40
Person_p <- 2/40

moe_stud <- qnorm(.975)*sqrt((Study_p*(1-Study_p)/39)*((Science_pop-Sample_sn)/Science_pop))
moe_stud
lowstudy <- Study_p-moe_stud
upstudy <- Study_p+moe_stud
lowstudy
upstudy

moe_usef <- qnorm(.975)*sqrt((NUsef_p*(1-NUsef_p)/39)*((Science_pop-Sample_sn)/Science_pop))
moe_usef
lowusef <- NUsef_p-moe_usef
upusef <- NUsef_p+moe_usef
lowusef
upusef

moe_other <- qnorm(.975)*sqrt((Other_p*(1-Other_p)/39)*((Science_pop-Sample_sn)/Science_pop))
moe_other
lowother <- Other_p-moe_other
upother <- Other_p+moe_other
lowother
upother

moe_person <- qnorm(.975)*sqrt((Person_p*(1-Person_p)/39)*((Science_pop-Sample_sn)/Science_pop))
moe_person
lowperson <- Person_p-moe_person
uperson <- Person_p+moe_person
lowperson
uperson

```

Selected the most chosen reasons to skip class: (Students skip class to use that time for study purposes, Students believe the class they skip is not interesting/useful enough, Other reasons involving: Optimizing time management, Tiredness, Not being able to focus)

CI for average skip classes 
Proportion analysis for year of study
Proportion analysis for Reasons


#Mean and Confidence Intervals for Percentage Classes Skipped
```{r}
n<-nrow(Skip_class)
#total amount of science undergraduates
N<-7400

#Sample mean
ybar<-mean(Skip_class.imputed$Percentage.Skip)

#Sample sd
s<- sd(Skip_class.imputed$Percentage.Skip)

z<-qnorm(0.975)

#Confidence interval
lowbo<-ybar-z*sqrt(1-(n/N))*(s/sqrt(n))
upbo<-ybar+z*sqrt(1-(n/N))*(s/sqrt(n))

ybar
c(lowbo, upbo)

```

Regression Estimation:
```{r}
#Find the strongest correlation
cor(Percentage.Skip, Grades.affected)
cor(Percentage.Skip, Year.Study)
cor(Percentage.Skip, Transport)
cor(Percentage.Skip, Gender)

#Graphic for % skipped and year of study
ggplot(data=Skip_class.imputed, aes(x=Percentage.Skip, y= Year.Study)) + geom_point(col="salmon", size=2) + stat_smooth(method = "lm", col="lightblue") + xlab("Percentage of skipped classes") + ylab("Year of study") + ggtitle("Percentage skipped with year of study")


favstats(~Year.Study, data = Skip_class.imputed)
favstats(~Percentage.Skip, data = Skip_class.imputed)

attach(Skip_class.imputed)


sum(Skip_class.imputed$Year.Study*Skip_class.imputed$Percentage.Skip)
meansproduct <-23.9*2.5
ryrs <- (2653-(40*meansproduct))/(39*21.26126*1.132277)
ryrs
y_intercept <- ryrs*(21.26126/1.132277)
y_intercept
y_slope <- 23.9-(y_intercept*2.5)
y_slope

yrs.model <- lm(Percentage.Skip~Year.Study, data = Skip_class.imputed)
yrs.model$coefficients
aov(summary(yrs.model))
mse.yrs <- 15420.58/38
ryrsq <- (1802.262/(1802.262+15420.58))
ryrsq
rsquared(yrs.model)

#Estimation of the grand Mean of Y(Percentage skipped)(Assuming a mean population of 4th year students)

ybar_reg_fourth <- 23.9+5.26*(4-2.5)
moe_reg <- qnorm(.975)*sqrt((7360/7400)*(mse.yrs/40))
lwb <- ybar_reg_fourth-moe_reg
upb <- ybar_reg_fourth+moe_reg
cat("95% Regression Est. CI with 4th year students mean: [", lwb, ",", upb, "]\n")

ybar_reg_third <- 23.9+5.26*(3-2.5)
moe_regth <- qnorm(.975)*sqrt((7360/7400)*(mse.yrs/40))
lwbth <- ybar_reg_third-moe_reg
upbth <- ybar_reg_third+moe_reg
cat("95% Regression Est. CI with 3rd year students mean: [", lwbth, ",", upbth, "]\n")

ybar_reg_second <- 23.9+5.26*(2-2.5)
moe_reg <- qnorm(.975)*sqrt((7360/7400)*(mse.yrs/40))
lwbsc <- ybar_reg_second-moe_reg
upbsc <- ybar_reg_second+moe_reg
cat("95% Regression Est. CI with 2nd year students mean: [", lwbsc, ",", upbsc, "]\n")

ybar_reg_first <- 23.9+5.26*(1-2.5)
moe_reg <- qnorm(.975)*sqrt((7360/7400)*(mse.yrs/40))
lwbfst <- ybar_reg_first-moe_reg
upbfst <- ybar_reg_first+moe_reg
cat("95% Regression Est. CI with 1st year students mean: [", lwbfst, ",", upbfst, "]\n")

```
Yi=5.26+10.75Xi

Ratio Estimation:
```{r}
attach(Skip_class.imputed)
rhat.yr <- 23.9/2.5

devS <- (Percentage.Skip - (rhat*Grades.affected))
mean(devS)
sum(devS^2)/39
var.rhat <- var(devS)
var.rhat

#1st year students
moe.rhatfst <- qnorm(.975)*sqrt((7360/7400)*(648.2298/40))
lbrfst <- (rhat.yr*1) - moe.rhatfst
uprfst <- (rhat.yr*1) + moe.rhatfst
cat("95% Ratio Estimation CI with 1st year students mean: [", lbrfst, ",", uprfst, "]\n")

#2nd year studs
moe.rhatsec <- qnorm(.975)*sqrt((7360/7400)*(648.2298/40))
lbrsec <- (rhat.yr*2) - moe.rhatsec
uprsec <- (rhat.yr*2) + moe.rhatsec
cat("95% Ratio Estimation CI with 2nd year students mean: [", lbrsec, ",", uprsec, "]\n")

#3rd year studs
moe.rhatthrd <- qnorm(.975)*sqrt((7360/7400)*(648.2298/40))
lbrthrd <- (rhat.yr*3) - moe.rhatthrd
uprthrd <- (rhat.yr*3) + moe.rhatthrd
cat("95% Ratio Estimation CI with 3rd year students mean: [", lbrthrd, ",", uprthrd, "]\n")

moe.rhatfrd <- qnorm(.975)*sqrt((7360/7400)*(648.2298/40))
lbrfrd <- (rhat.yr*4) - moe.rhatfrd
uprfrd <- (rhat.yr*4) + moe.rhatfrd
cat("95% Ratio Estimation CI with 4th year students mean: [", lbrfrd, ",", uprfrd, "]\n")
```


Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
